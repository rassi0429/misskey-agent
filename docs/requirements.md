# 要件定義書

## 1. プロジェクト概要

Misskeyインスタンス向けAIアシスタントBot。ユーザーごとにパーソナライズされた体験を提供する。

## 2. 対象環境

- **インスタンス規模**: 中規模（10人以上）
- **対象ユーザー**: インスタンスの全ユーザー

## 3. ユーザープロファイル

ユーザー1人につき、以下のファイルを管理：

| ファイル | 用途 |
|----------|------|
| `profile` | ユーザー基本情報（呼び方、好み等） |
| `to-do` | タスク管理 |
| `cron` | 定期実行タスク設定 |
| `backlog` | 未処理・保留タスク |

### 3.1 プロファイルに含める情報（検討中）

- ユーザーID（Misskey）
- 表示名 / 呼び方の設定
- 最終アクティブノートのID/時刻
- 好みの設定（口調、通知頻度等）
- 会話履歴（どこまで保持するか要検討）

## 4. Botの反応条件

### 4.1 監視対象

- **ローカルTLの全投稿を監視**
- プライベート投稿以外すべてが対象

### 4.2 反応判断

**AIが投稿内容を見て反応すべきか判断する**

| 条件 | 反応 |
|------|------|
| メンションあり | 必ず反応 |
| タスク/リマインド系キーワード | 反応 |
| 質問・助けを求めている | 反応 |
| AIが価値提供できると判断 | 反応 |
| 他ユーザーとの会話中 | 控える |
| 独り言・感情吐露 | 控える |

### 4.3 返信の公開範囲

元の投稿と同じ公開範囲で返信する。

## 5. 主要機能（想定）

### 5.1 今北産業（TLまとめ）

ユーザーの最終ノート以降のローカルTLの出来事をまとめる。

```
@ai 今北産業
```

**動作フロー:**
1. ユーザープロファイルから最終ノート時刻を取得
2. その時刻以降のローカルTLを取得
3. AIで3行にまとめて返信
4. 最終ノート時刻を更新

### 5.2 タスク管理（to-do / backlog）

```
@ai タスク追加: ○○をやる
@ai タスク一覧
@ai 完了: ○○
```

### 5.3 定期実行（cron）

```
@ai 毎朝9時にリマインド: ○○
@ai cron一覧
```

### 5.4 自由会話

上記コマンド以外は自由な会話として処理。

## 6. 非機能要件

### 6.1 パフォーマンス
- 応答時間: TBD
- 同時リクエスト対応: 中規模を想定

### 6.2 セキュリティ
- ユーザーデータの分離
- API キーの安全な管理

### 6.3 運用
- ログ出力
- エラー時の通知/リカバリ

## 7. Bot人格設定

- **口調**: フレンドリー（タメ口）
- **性格**: 気さくで頼りになる友達
- **詳細**: [UX設計書](./ux-design.md) 参照

## 8. 未決定事項

- [ ] 会話履歴の保持期間/件数
- [ ] レート制限の具体的な数値
- [ ] cronの実行タイミング精度
- [ ] 複数ノートにまたがる長文の扱い
- [ ] 画像/ファイル添付への対応
- [ ] AIモデルの選定（Claude, GPT等）
- [ ] データ保存方式（ファイル / DB）
